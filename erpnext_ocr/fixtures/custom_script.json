[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2018-02-03 20:25:41.400873", 
  "name": "Sales Invoice-Client", 
  "script": "\nvar tree_outerHTML = \"\";\nvar tree = \"\";\n\nfunction expand_all() {\n    console.log('expand all!');\n    console.log(tree);\n\t\t\t\ttree.expandTree();\n\t\t\t}\n\n\n\t\t\tfunction collapse_all() {\n\t\t\t\ttree.collapseTree();\n\t\t\t}\n    // window.onload = addListeners();\n    //\n    // function addListeners(){\n    //     document.getElementById('dxy').addEventListener('mousedown', mouseDown, false);\n    //     window.addEventListener('mouseup', mouseUp, false);\n    //\n    // }\n    //\n    // function mouseUp()\n    // {\n    //     window.removeEventListener('mousemove', divMove, true);\n    // }\n    //\n    // function mouseDown(e){\n    //   window.addEventListener('mousemove', divMove, true);\n    // }\n\n    var init_ocr = function(frm)\n    {\n                // console.log('OCR RECEIPT');\n                function copyToClipboard(id) {\n        // console.log(id);\n        // console.log(id);\n        // console.log(id);\n        var copyText = document.getElementById(id);\n        /* Select the text field */\n      copyText.select();\n\n      /* Copy the text inside the text field */\n      document.execCommand(\"Copy\");\n\n    }\n\n                        frappe.call({\n                            method: \"erpnext_ocr.erpnext_ocr.xml_reader.read\",\n                            args: {\n                                \"ocr_receipt\": cur_frm.doc.ocr_receipt\n                            },\n                            callback: function (r, rt) {\n                                // console.log(r);\n                                var html = \"<div id='ocr_dial'>\";\n                                html += \"<div class='row'><div class='col-xs-2'>\" +\n                                    \"<b>Source: </b></div><div class='col-xs-5'>\" +\n                                    \"<input type='text' id='p1' value='\" + r.message['source'] + \"' class='form-check-input'></div>\" +\n                                    \"<div class='col-xs-3'><button id='bt1' class='btn btn-primary'>Copy Text</button></div></div>\";\n\n\n                                html += \"<br><div class='row'> <div class='col-xs-2'><b>Vendor Name: </b></div>\" +\n                                    \"<div class='col-xs-5'> <input type='text' id='p2' value='\" + r.message['vendor_name'] + \"' class='form-check-input'></div>\" +\n                                    \"<div class='col-xs-3'> <button id='bt2' class='btn btn-primary'>Copy Text</button></div></div>\";\n\n\n                                // html += \"<br><b>Vendor Address: </b><input type='text' id='p3' value='\" + r.message['vendor_address'] + \"'><button id='bt3'>Copy Text</button>\";\n                                // html += \"<br><b>Invoice Date: </b><input type='text' id='p4' value='\" + r.message['invoice_date'] + \"'><button id='bt4'>Copy Text</button>\";\n                                // html += \"<br><b>Sub Total: </b><input type='text' id='p5' value='\" + r.message['subTotal'] + \"'><button id='bt5'>Copy Text</button>\";\n                                // html += \"<br><b>Payment Value: </b><input type='text' id='p6' value='\" + r.message['payment_val'] + \"'><button id='bt6'>Copy Text</button>\";\n\n                                  html += \"<br><div class='row'> <div class='col-xs-2'><b>Vendor Address: </b></div>\" +\n                                    \"<div class='col-xs-5'> <input type='text' id='p3' value='\" + r.message['vendor_address'] + \"' class='form-check-input'></div>\" +\n                                    \"<div class='col-xs-3'> <button id='bt3' class='btn btn-primary'>Copy Text</button></div></div>\";\n\n                                 html += \"<br><div class='row'> <div class='col-xs-2'><b>Invoice Date: </b></div>\" +\n                                    \"<div class='col-xs-5'> <input type='text' id='p4' value='\" + r.message['invoice_date'] + \"' class='form-check-input'></div>\" +\n                                    \"<div class='col-xs-3'> <button id='bt4' class='btn btn-primary'>Copy Text</button></div></div>\";\n\n                                          html += \"<br><div class='row'> <div class='col-xs-2'><b>Sub Total: </b></div>\" +\n                                    \"<div class='col-xs-5'> <input type='text' id='p5' value='\" + r.message['subTotal'] + \"' class='form-check-input'></div>\" +\n                                    \"<div class='col-xs-3'> <button id='bt5' class='btn btn-primary'>Copy Text</button></div></div>\";\n\n                                     html += \"<br><div class='row'> <div class='col-xs-2'><b>Payment Value: </b></div>\" +\n                                    \"<div class='col-xs-5'> <input type='text' id='p6' value='\" + r.message['payment_val'] + \"' class='form-check-input'></div>\" +\n                                    \"<div class='col-xs-3'> <button id='bt6' class='btn btn-primary'>Copy Text</button></div></div>\";\n\n                                html +=\"</div>\";\n\n                                var html_2 = \"<div id='ocr_dial_2'>\";\n                                html_2 += \"<br><br><b>Recognized Items: </b>\";\n                                //ITEMS\n                                for (var i = 0; i < r.message['items'].length; i++) {\n                                    // console.log(i);\n\n                                     html_2 += \"<br><div class='row'> <div class='col-xs-2'><b>Name: </b></div>\" +\n                                    \"<div class='col-xs-5'> \" +\n                                         \"<input type='text' id='p7_\" + (i).toString() + \"' value='\" + r.message['items'][i]['item_code'] + \"' class='form-check-input'></div>\" +\n                                    \"<div class='col-xs-3'> <button id='bt7_\" + (i).toString() +\"' class='btn btn-primary'>Copy Text</button></div></div>\";\n\n                                     html_2 += \"<div class='row'> <div class='col-xs-2'><b>Qty.: </b></div>\" +\n                                    \"<div class='col-xs-5'> \" +\n                                         \"<input type='text' id='p8_\" + (i).toString() + \"' value='\" + r.message['items'][i]['qty'] + \"' class='form-check-input'></div>\" +\n                                    \"<div class='col-xs-3'> <button id='bt8_\" + (i).toString() +\"' class='btn btn-primary'>Copy Text</button></div></div>\";\n\n                                     html_2 += \"<div class='row'> <div class='col-xs-2'><b>Amount: </b></div>\" +\n                                    \"<div class='col-xs-5'> \" +\n                                         \"<input type='text' id='p9_\" + (i).toString() + \"' value='\" + r.message['items'][i]['total'] + \"' class='form-check-input'></div>\" +\n                                    \"<div class='col-xs-3'> <button id='bt9_\" + (i).toString() +\"' class='btn btn-primary'>Copy Text</button></div></div>\";\n\n\n                                }\n                                html_2+=\"</div>\";\n                                // console.log(html);\n\n                                // d.fields_dict.ht.$wrapper.html(html);\n\n                                $(frm.fields_dict.window.wrapper).html(html);\n                                $(frm.fields_dict.window_2.wrapper).html(html_2);\n\n                                // d.make();\n                                // d.get_close_btn().toggle(false);\n                                // d.show();\n\n                                document.getElementById(\"bt1\").addEventListener(\"click\", function () {\n                                        copyToClipboard(\"p1\");\n                                    }\n                                    , false);\n\n\n                                document.getElementById(\"bt2\").addEventListener(\"click\", function () {\n                                        copyToClipboard(\"p2\");\n                                    }\n                                    , false);\n\n\n                                document.getElementById(\"bt3\").addEventListener(\"click\", function () {\n                                        copyToClipboard(\"p3\");\n                                    }\n                                    , false);\n\n\n                                document.getElementById(\"bt4\").addEventListener(\"click\", function () {\n                                        copyToClipboard(\"p4\");\n                                    }\n                                    , false);\n\n\n                                document.getElementById(\"bt5\").addEventListener(\"click\", function () {\n                                        copyToClipboard(\"p5\");\n                                    }\n                                    , false);\n\n                                document.getElementById(\"bt6\").addEventListener(\"click\", function () {\n                                        copyToClipboard(\"p6\");\n                                    }\n                                    , false);\n\n                                var ii, bb, pp;\n                                for (ii = 0; ii < r.message['items'].length; ii++) {\n                                    (function () {\n                                        // console.log(ii);\n                                        var j = ii;\n                                        var bb = \"bt7_\" + (j).toString();\n                                        var pp = \"p7_\" + (j).toString();\n                                        // console.log(bb);\n                                        // console.log(pp);\n\n                                        document.getElementById(bb).addEventListener(\"click\", function () {\n                                                copyToClipboard(pp);\n                                            }\n                                            , false);\n\n                                        document.getElementById(\"bt8_\" + (j).toString()).addEventListener(\"click\", function () {\n                                                copyToClipboard(\"p8_\" + (j).toString());\n                                            }\n                                            , false);\n\n                                        document.getElementById(\"bt9_\" + (j).toString()).addEventListener(\"click\", function () {\n                                                copyToClipboard(\"p9_\" + (j).toString());\n                                            }\n                                            , false);\n                                   }());\n                                }\n\n\n\n\n                            }\n\n                        });\n\n\n    }\n\n    frappe.ui.form.on('Sales Invoice', 'ocr_receipt',\n        function(frm){\n\n            // init_ocr(frm);\n            console.log(tree_outerHTML);\n            $(frm.fields_dict.window.wrapper).html(tree_outerHTML);\n            console.log('ocr picked!');\n              document.getElementById(\"expand_bt\").addEventListener(\"click\", function () {\n                                        expand_all();\n                                    }\n                                    , false);\n        });\n\n\n    // frappe.ui.form.on(\"Sales Invoice\",\"onload\",function(frm){\n    //\n    //     // console.log(document.getElementById(\"container\"));\n    // });\n\n\n    frappe.ui.form.on('Sales Invoice', {\n        // validate:function (frm) {\n        //\n        // },\n\n        refresh: function (frm) {\n\n\n  tree = createTree('div_tree','white');\n\n        var node1 = tree.createNode('First node',false,'/files/star.png',null,null,null);\n        node1.createChildNode('First child node', false, '/files/blue_key.png',null,null);\n\n        tree.drawTree();\n\n\n        node1 = tree.createNode('Second node',false,'/files/star.png',null,null,null);\n        node1.createChildNode('Second child node', false, '/files/blue_key.png',null,null);\n\n             tree_outerHTML = document.getElementById(\"div_tree\").outerHTML;\n                tree_outerHTML+=\"<button id='expand_bt'>Expand All Nodes</button>\";\n\n//             console.log(tree);\n//     console.log(tree.innerHTML);\n// console.log(document.getElementById(\"div_tree\").outerHTML);\n\n         // $(frm.fields_dict.window.wrapper).html(document.getElementById(\"div_tree\").outerHTML);\n\n            // init_ocr(frm);\n        }\n\n    });\n\n\n\n", 
  "script_type": "Client"
 }
]